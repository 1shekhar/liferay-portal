buildscript {
	dependencies {
		classpath fileTree(dir: pluginClasspathDir, include: "*.jar")
	}
}

apply plugin: "com.liferay.target.platform"
apply plugin: "java"

dependencies {
	compile group: "com.liferay.portal", name: "com.liferay.portal.kernel"

	targetPlatformBoms group: "com.liferay", name: "com.liferay.ce.portal.bom", version: "7.0.4"
}

task runGradleTest

runGradleTest {
	doLast {
		def expectedFailure

		try {
			project.configurations["targetPlatform"]
		}
		catch (Exception e) {
			expectedFailure = e
		}

		assert expectedFailure.message == "Configuration with name 'targetPlatform' not found."

		assert dependencyManagement.managedVersions.size() == 898

		try {
			configurations.compile.resolvedConfiguration.resolvedArtifacts
		}
		catch (ResolveException e) {
			e.printStackTrace()
			expectedFailure = e.cause
		}

		assert expectedFailure.message.contains("com.liferay.portal:com.liferay.portal.kernel:2.61.1")
	}
}
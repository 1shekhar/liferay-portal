buildscript {
	dependencies {
		classpath fileTree(dir: pluginClasspathDir, include: "*.jar")
	}
	repositories {
		maven {
			url "https://cdn.lfrs.sl/repository.liferay.com/nexus/content/groups/public"
		}
	}
}

apply plugin: "com.liferay.target.platform"

dependencies {
	targetPlatformBoms group: "com.liferay", name: "com.liferay.ce.portal.bom", version: "7.0.4"
	targetPlatformBoms group: "com.liferay", name: "com.liferay.ce.portal.compile.only", version: "7.0.4"

	targetPlatformDistro files("../../repo/distro.jar")
}

targetPlatform {
	ideIncludeGroup "com.liferay", "com.liferay.portal"
}

task runGradleTest

runGradleTest {
	dependsOn resolve

	doLast {
		def bndrunText = file("${project.buildDir}/resolve.bndrun").text

		assert bndrunText.contains("foo.api;version='[1.0.0,1.0.1)")
		assert bndrunText.contains("foo.portlet;version='[1.0.0,1.0.1)")
		assert bndrunText.contains("foo.service;version='[1.0.0,1.0.1)")
	}
}
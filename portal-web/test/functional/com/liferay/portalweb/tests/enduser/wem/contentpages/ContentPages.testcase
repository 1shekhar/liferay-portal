<definition component-name="portal-wcm">
	<property name="portal.release" value="true" />
	<property name="portal.upstream" value="true" />
	<property name="testray.main.component.name" value="Content Pages" />

	<set-up>
		<execute macro="TestCase#setUpPortalInstance" />

		<execute macro="User#firstLoginPG" />

		<execute macro="JSONGroup#addGroup">
			<var name="groupName" value="Test Site Name" />
		</execute>

		<execute macro="FragmentsAdmin#openFragmentsAdmin">
			<var name="siteURLKey" value="test-site-name" />
		</execute>

		<execute macro="FragmentsAdmin#importCollectionFromDependenciesFolder">
			<var name="collectionZipFile" value="fragment-collection.zip" />
		</execute>
	</set-up>

	<tear-down>
		<var method="PropsUtil#get('test.portal.instance')" name="testPortalInstance" />

		<if>
			<equals arg1="${testPortalInstance}" arg2="true" />
			<then>
				<execute macro="PortalInstances#tearDownCP" />
			</then>
			<else>
				<execute macro="JSONGroup#deleteGroupByName">
					<var name="groupName" value="Test Site Name" />
				</execute>
			</else>
		</if>
	</tear-down>

	<command name="AddContentPage" priority="5">
		<description message="Add a content page with fragments." />
		<property name="portal.acceptance" value="true" />

		<execute macro="SitePages#openPagesAdmin">
			<var name="siteURLKey" value="test-site-name" />
		</execute>

		<execute macro="ContentPages#addPage">
			<var name="pageName" value="Test Content Page Name" />
		</execute>

		<execute macro="PageEditor#addFragment">
			<var name="collectionName" value="Collection Name" />
			<var name="fragmentName" value="Title" />
		</execute>

		<execute macro="PageEditor#addFragment">
			<var name="collectionName" value="Collection Name" />
			<var name="fragmentName" value="Rich Text" />
		</execute>

		<execute macro="PageEditor#addFragment">
			<var name="collectionName" value="Collection Name" />
			<var name="fragmentName" value="Button" />
		</execute>

		<execute macro="Navigator#openWithAppendToBaseURL">
			<var name="urlAppend" value="web/test-site-name/test-content-page-name" />
		</execute>

		<execute function="AssertVisible" locator1="Fragment#FRAGMENT">
			<var name="key_content" value="Lorem ipsum dolor sit amet" />
			<var name="key_fragmentClass" value="header" />
			<var name="key_position" value="1" />
		</execute>

		<execute function="AssertVisible" locator1="Fragment#FRAGMENT">
			<var name="key_content" value="Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum." />
			<var name="key_fragmentClass" value="rich-text" />
			<var name="key_position" value="2" />
		</execute>

		<execute function="AssertVisible" locator1="Fragment#FRAGMENT">
			<var name="key_content" value="Submit" />
			<var name="key_fragmentClass" value="footer" />
			<var name="key_position" value="3" />
		</execute>

		<execute function="AssertVisible" locator1="Fragment#FRAGMENT">
			<var name="key_content" value="Cancel" />
			<var name="key_fragmentClass" value="footer" />
			<var name="key_position" value="3" />
		</execute>

		<for list="Submit,Cancel" param="button">
			<execute macro="Button#viewPresent">
				<var name="button" value="${button}" />
			</execute>
		</for>
	</command>

	<command name="AddContentPageFromPageTemplate" priority="5">
		<description message="Create a content page from a page template with fragments." />
		<property name="portal.acceptance" value="true" />

		<execute macro="PageTemplatesAdmin#openPageTemplatesAdmin">
			<var name="siteURLKey" value="test-site-name" />
		</execute>

		<execute macro="PageTemplatesAdmin#addCollection">
			<var name="collectionName" value="Page Template Collection" />
		</execute>

		<execute macro="PageTemplatesAdmin#add">
			<var name="pageTemplateName" value="Page Template Name" />
		</execute>

		<execute macro="PageEditor#addFragment">
			<var name="collectionName" value="Collection Name" />
			<var name="fragmentName" value="Button" />
		</execute>

		<execute macro="Button#clickPublish" />

		<execute macro="SitePages#openPagesAdmin">
			<var name="siteURLKey" value="test-site-name" />
		</execute>

		<execute macro="ContentPages#addPage">
			<var name="collectionName" value="Page Template Collection" />
			<var name="pageName" value="Test Page Name" />
			<var name="pageTemplateName" value="Page Template Name" />
		</execute>

		<execute macro="Navigator#gotoSitePage">
			<var name="pageName" value="Test Page Name" />
			<var name="siteName" value="Test Site Name" />
		</execute>

		<for list="Submit,Cancel" param="button">
			<execute macro="Button#viewPresent">
				<var name="button" value="${button}" />
			</execute>
		</for>

		<execute macro="Button#clickNoError">
			<var name="button" value="Submit" />
		</execute>

		<execute function="AssertConfirm" value1="Form submitted" />
	</command>

	<command name="AddContentPageWithEditedFragmentText" priority="5">
		<description message="Add a content page and edit its fragment immediately. This is a variation of the steps from LPS-85872." />

		<execute macro="SitePages#openPagesAdmin">
			<var name="siteURLKey" value="test-site-name" />
		</execute>

		<execute macro="ContentPages#addPage">
			<var name="pageName" value="Test Content Page Name" />
		</execute>

		<execute macro="PageEditor#addFragment">
			<var name="collectionName" value="Collection Name" />
			<var name="fragmentName" value="Content" />
		</execute>

		<execute macro="PageEditor#editFragmentText">
			<var name="fragmentName" value="Content" />
			<var name="id" value="content" />
			<var name="text" value="New editable fragment text" />
		</execute>

		<execute macro="Navigator#openWithAppendToBaseURL">
			<var name="urlAppend" value="web/test-site-name/test-content-page-name" />
		</execute>

		<execute function="AssertVisible" locator1="Fragment#FRAGMENT">
			<var name="key_content" value="New editable fragment text" />
			<var name="key_fragmentClass" value="body" />
			<var name="key_position" value="1" />
		</execute>
	</command>

	<command name="EditContentPage" priority="5">
		<description message="Edit an existing content page that has fragments. This testcase covers the bug found in LPS-85872." />

		<execute macro="SitePages#openPagesAdmin">
			<var name="siteURLKey" value="test-site-name" />
		</execute>

		<execute macro="ContentPages#addPage">
			<var name="pageName" value="Test Content Page Name" />
		</execute>

		<execute macro="PageEditor#addFragment">
			<var name="collectionName" value="Collection Name" />
			<var name="fragmentName" value="Title" />
		</execute>

		<execute macro="PageEditor#addFragment">
			<var name="collectionName" value="Collection Name" />
			<var name="fragmentName" value="Rich Text" />
		</execute>

		<execute macro="Navigator#openWithAppendToBaseURL">
			<var name="urlAppend" value="web/test-site-name/test-content-page-name" />
		</execute>

		<execute macro="ContentPages#gotoEdit" />

		<execute macro="PageEditor#addFragment">
			<var name="collectionName" value="Collection Name" />
			<var name="fragmentName" value="Content" />
		</execute>

		<execute macro="PageEditor#editFragmentText">
			<var name="fragmentName" value="Rich Text" />
			<var name="id" value="rich-text" />
			<var name="text" value="New editable fragment text" />
		</execute>

		<execute macro="PageEditor#moveFragment">
			<var name="direction" value="down" />
			<var name="fragmentName" value="Title" />
		</execute>

		<execute macro="Navigator#openWithAppendToBaseURL">
			<var name="urlAppend" value="web/test-site-name/test-content-page-name" />
		</execute>

		<execute function="AssertVisible" locator1="Fragment#FRAGMENT">
			<var name="key_content" value="New editable fragment text" />
			<var name="key_fragmentClass" value="rich-text" />
			<var name="key_position" value="1" />
		</execute>

		<execute function="AssertVisible" locator1="Fragment#FRAGMENT">
			<var name="key_content" value="Lorem ipsum dolor sit amet" />
			<var name="key_fragmentClass" value="header" />
			<var name="key_position" value="2" />
		</execute>

		<execute function="AssertVisible" locator1="Fragment#FRAGMENT">
			<var name="key_content" value="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean tempus eleifend lacus nec porttitor. Vestibulum pharetra ullamcorper felis volutpat commodo. Nam id ipsum placerat, hendrerit orci eu, congue nisi. Proin." />
			<var name="key_fragmentClass" value="body" />
			<var name="key_position" value="3" />
		</execute>
	</command>

	<command name="EditImportedContentPageViaImportedSiteTemplate" priority="3">
		<description message="This is a use case for LPS-86501." />

		<execute macro="ProductMenu#gotoPortlet">
			<var name="category" value="Sites" />
			<var name="panel" value="Control Panel" />
			<var name="portlet" value="Site Templates" />
		</execute>

		<execute macro="SiteTemplates#addCP">
			<var name="siteTemplateActive" value="Yes" />
			<var name="siteTemplateName" value="Site Template Name" />
		</execute>

		<execute macro="LexiconEntry#gotoEntryMenuItem">
			<var name="menuItem" value="Manage" />
			<var name="rowEntry" value="Site Template Name" />
		</execute>

		<execute macro="ProductMenu#gotoPortlet">
			<var name="category" value="Build" />
			<var name="panel" value="Site Administration" />
			<var name="portlet" value="Page Fragments" />
		</execute>

		<execute macro="FragmentsAdmin#importCollectionFromDependenciesFolder">
			<var name="collectionZipFile" value="fragment-collection.zip" />
		</execute>

		<execute macro="ProductMenu#gotoPortlet">
			<var name="category" value="Sites" />
			<var name="panel" value="Control Panel" />
			<var name="portlet" value="Site Templates" />
		</execute>

		<execute macro="SiteTemplates#addSitePageViaSiteTemplateCP">
			<var name="pageName" value="Test Template Content Page" />
			<var name="sitePageType" value="Content Page" />
			<var name="siteTemplateName" value="Site Template Name" />
		</execute>

		<execute macro="PageEditor#addFragment">
			<var name="collectionName" value="Collection Name" />
			<var name="fragmentName" value="Content" />
		</execute>

		<execute macro="PageEditor#editFragmentText">
			<var name="fragmentName" value="Content" />
			<var name="id" value="content" />
			<var name="text" value="Editing Finished" />
		</execute>

		<execute macro="PageEditor#viewFragmentEditableText">
			<var name="editableText" value="Editing Finished" />
			<var name="fragmentName" value="Content" />
			<var name="id" value="content" />
		</execute>

		<execute macro="ProductMenu#gotoPortlet">
			<var name="category" value="Sites" />
			<var name="panel" value="Control Panel" />
			<var name="portlet" value="Site Templates" />
		</execute>

		<execute macro="LAR#exportPortlet">
			<var name="larFileName" value="site-template-content-page.lar" />
			<var name="portletName" value="Site Templates" />
		</execute>

		<execute macro="ProductMenu#gotoPortlet">
			<var name="category" value="Sites" />
			<var name="panel" value="Control Panel" />
			<var name="portlet" value="Site Templates" />
		</execute>

		<execute macro="SiteTemplates#deleteCP">
			<var name="siteTemplateName" value="Site Template Name" />
		</execute>

		<execute macro="ProductMenu#gotoPortlet">
			<var name="category" value="Sites" />
			<var name="panel" value="Control Panel" />
			<var name="portlet" value="Site Templates" />
		</execute>

		<execute macro="LAR#importPortlet">
			<var name="larFileName" value="site-template-content-page.lar" />
			<var name="portletName" value="Site Templates" />
		</execute>

		<execute macro="SiteTemplates#viewCP">
			<var name="siteTemplateName" value="Site Template Name" />
		</execute>

		<execute function="Refresh" />

		<execute macro="LexiconEntry#gotoEntryMenuItem">
			<var name="menuItem" value="Manage" />
			<var name="rowEntry" value="Site Template Name" />
		</execute>

		<execute macro="SitePages#gotoPageMenuItem">
			<var name="menuItem" value="Edit" />
			<var name="pageName" value="Test Template Content Page" />
		</execute>

		<execute macro="PageEditor#viewFragmentEditableText">
			<var name="editableText" value="Editing Finished" />
			<var name="fragmentName" value="Content" />
			<var name="id" value="content" />
		</execute>

		<execute function="AssertConsoleTextNotPresent" value1="javax.portlet.PortletException: org.apache.jasper.JasperException: java.lang.NullPointerException" />
	</command>
</definition>